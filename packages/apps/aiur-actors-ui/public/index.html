<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aiur Actors UI</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <!-- Single mount point - App component creates everything -->
    <div id="app"></div>

    <!-- Application Scripts -->
    <script type="module">
        import { AiurActorsApp } from '/app/AiurActorsApp.js';
        import { ComponentFactory } from '/components/ComponentFactory.js';
        import { ClientActorSpace } from '/actors/ClientActorSpace.js';
        
        // Initialize the application when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Create actor space
                const actorSpace = new ClientActorSpace();
                
                // Create component factory
                const componentFactory = new ComponentFactory();
                
                // Get WebSocket URL from environment or use default
                const wsUrl = window.AIUR_WS_URL || 'ws://localhost:8080/ws';
                
                // Create application instance
                const app = new AiurActorsApp({
                    dom: document.getElementById('app'),
                    componentFactory,
                    actorSpace,
                    options: {
                        websocketUrl: wsUrl,
                        theme: 'dark',
                        terminal: {
                            fontSize: '14px',
                            fontFamily: 'Consolas, Monaco, "Courier New", monospace',
                            maxOutputLines: 1000
                        },
                        onConnectionError: (error) => {
                            console.error('WebSocket connection error:', error);
                            updateConnectionStatus('error');
                        },
                        onReady: (app) => {
                            console.log('Application ready');
                            updateConnectionStatus('connected');
                        }
                    }
                });
                
                // Initialize and start the application
                await app.initialize();
                app.start();
                
                // Store app reference globally for debugging
                window.aiurApp = app;
                
                // Update connection status
                function updateConnectionStatus(status) {
                    const statusEl = document.getElementById('connection-status');
                    if (statusEl) {
                        statusEl.className = `connection-status status-${status}`;
                        const textEl = statusEl.querySelector('.status-text');
                        if (textEl) {
                            switch (status) {
                                case 'connected':
                                    textEl.textContent = 'Connected';
                                    break;
                                case 'error':
                                    textEl.textContent = 'Connection Error';
                                    break;
                                default:
                                    textEl.textContent = 'Disconnected';
                            }
                        }
                    }
                }
                
                // Handle window unload
                window.addEventListener('beforeunload', () => {
                    app.destroy();
                });
                
            } catch (error) {
                console.error('Failed to initialize application:', error);
                document.body.innerHTML = `
                    <div class="error-container">
                        <h1>Application Error</h1>
                        <p>Failed to initialize Aiur Actors UI</p>
                        <pre>${error.message}</pre>
                        <button onclick="location.reload()">Reload</button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>